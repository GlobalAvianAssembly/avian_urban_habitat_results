---
title: "R Notebook"
output: html_notebook
---
Run `download_data.Rmd` and `percentage_of_regional_richness.Rmd` First!

```{r}
city_data
```

```{r}
fetch_city_data_for <- function(pool_name) {
  results_filename <- paste(paste(pool_name, 'city', 'richness', 'intercept', sep = "_"), "csv", sep = ".")
  results <- read_csv(results_filename)
  
  joined <- left_join(city_data, results)
  
  pool_size_col_name <- paste(pool_name, 'pool', 'size', sep = "_")
  
  joined[,c("response", pool_size_col_name, "population_growth", "rainfall_monthly_min", "rainfall_annual_average", "rainfall_monthly_max", "temperature_annual_average", "temperature_monthly_min", "temperature_monthly_max", "happiness_negative_effect", "happiness_positive_effect", "happiness_future_life", "number_of_biomes", "realm", "biome_name", "region_20km_includes_estuary", "region_50km_includes_estuary", "region_100km_includes_estuary", "city_includes_estuary", "region_20km_average_pop_density", "region_50km_average_pop_density", "region_100km_average_pop_density", "city_max_pop_density", "city_average_pop_density", "mean_population_exposure_to_pm2_5_2019", "region_20km_cultivated", "region_20km_urban", "region_50km_cultivated", "region_50km_urban", "region_100km_cultivated", "region_100km_urban", "region_20km_elevation_delta", "region_20km_mean_elevation", "region_50km_elevation_delta", "region_50km_mean_elevation", "region_100km_elevation_delta", "region_100km_mean_elevation", "city_elevation_delta", "city_mean_elevation", "urban", "shrubs", "permanent_water", "open_forest", "herbaceous_wetland", "herbaceous_vegetation", "cultivated", "closed_forest", "share_of_population_within_400m_of_open_space", "percentage_urban_area_as_streets", "percentage_urban_area_as_open_public_spaces_and_streets", "percentage_urban_area_as_open_public_spaces", "city_gdp_per_population")]
}
```


```{r}
merlin_city_data <- fetch_city_data_for('merlin')
merlin_city_data
```

```{r}
library(randomForest)
library(reshape2)
library(rpart)
library(ggplot2)
library(tidyverse)
```

```{r}
merlin_city_data_fixed <- rfImpute(response ~ ., merlin_city_data)
merlin_city_data_fixed
```


```{r}
source('./random_forest_selection_functions.R')
```

```{r}
select_variables_from_random_forest(merlin_city_data_fixed)
```

```{r}
exclude_merlin <- !names(merlin_city_data_fixed) %in% c("region_50km_urban", "region_100km_urban", "region_50km_elevation_delta", "region_100km_elevation_delta", "region_50km_cultivated", "region_100km_cultivated", "region_20km_average_pop_density", "region_100km_average_pop_density", "region_20km_includes_estuary", "region_50km_includes_estuary", "region_100km_includes_estuary", "region_100km_mean_elevation", "region_50km_mean_elevation", "region_20km_mean_elevation")

merlin_city_data_fixed_single_scale <- merlin_city_data_fixed[,exclude_merlin]
merlin_city_data_fixed_single_scale
```

```{r}
select_variables_from_random_forest(merlin_city_data_fixed_single_scale)
```

```{r}
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs", "region_20km_urban")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs", "region_20km_urban", "city_gdp_per_population")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs", "region_20km_urban", "city_gdp_per_population", "region_20km_cultivated")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs", "region_20km_urban", "city_gdp_per_population", "region_20km_cultivated", "happiness_negative_effect")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs", "region_20km_urban", "city_gdp_per_population", "region_20km_cultivated", "happiness_negative_effect", "share_of_population_within_400m_of_open_space")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs", "region_20km_urban", "city_gdp_per_population", "region_20km_cultivated", "happiness_negative_effect", "share_of_population_within_400m_of_open_space", "city_average_pop_density")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs", "region_20km_urban", "city_gdp_per_population", "region_20km_cultivated", "happiness_negative_effect", "share_of_population_within_400m_of_open_space", "city_average_pop_density", "temperature_monthly_max")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs", "region_20km_urban", "city_gdp_per_population", "region_20km_cultivated", "happiness_negative_effect", "share_of_population_within_400m_of_open_space", "city_average_pop_density", "temperature_monthly_max", "region_50km_average_pop_density")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs", "region_20km_urban", "city_gdp_per_population", "region_20km_cultivated", "happiness_negative_effect", "share_of_population_within_400m_of_open_space", "city_average_pop_density", "temperature_monthly_max", "region_50km_average_pop_density", "herbaceous_wetland")])
create_fifty_rows_of_oob(merlin_city_data_fixed[,c("response", "merlin_pool_size", "realm", "biome_name", "happiness_positive_effect", "rainfall_monthly_min", "temperature_annual_average", "region_20km_elevation_delta", "happiness_future_life", "temperature_monthly_min", "permanent_water", "shrubs", "region_20km_urban", "city_gdp_per_population", "region_20km_cultivated", "happiness_negative_effect", "share_of_population_within_400m_of_open_space", "city_average_pop_density", "temperature_monthly_max", "region_50km_average_pop_density", "herbaceous_wetland", "rainfall_annual_average")])
```

"merlin_pool_size", "realm"


```{r}
birdlife_city_data <- fetch_city_data_for('birdlife')
birdlife_city_data
```

```{r}
birdlife_city_data_fixed <- rfImpute(response ~ ., birdlife_city_data)
birdlife_city_data_fixed
```

```{r}
select_variables_from_random_forest(birdlife_city_data_fixed)
```

```{r}
exclude_birdlife <- !names(birdlife_city_data_fixed) %in% c("region_50km_cultivated", "region_20km_cultivated", "region_100km_average_pop_density", "region_50km_average_pop_density", "region_50km_urban", "region_20km_urban", "region_100km_elevation_delta", "region_50km_elevation_delta", "region_20km_includes_estuary", "region_50km_includes_estuary", "region_100km_includes_estuary", "region_100km_mean_elevation", "region_50km_mean_elevation", "region_20km_mean_elevation")

birdlife_city_data_fixed_single_scale <- birdlife_city_data_fixed[,exclude_birdlife]
birdlife_city_data_fixed_single_scale
```

```{r}
select_variables_from_random_forest(birdlife_city_data_fixed_single_scale)
```

```{r}
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019", "region_100km_urban")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019", "region_100km_urban", "temperature_annual_average")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019", "region_100km_urban", "temperature_annual_average", "shrubs")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019", "region_100km_urban", "temperature_annual_average", "shrubs", "region_20km_elevation_delta")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019", "region_100km_urban", "temperature_annual_average", "shrubs", "region_20km_elevation_delta", "percentage_urban_area_as_open_public_spaces_and_streets")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019", "region_100km_urban", "temperature_annual_average", "shrubs", "region_20km_elevation_delta", "percentage_urban_area_as_open_public_spaces_and_streets", "share_of_population_within_400m_of_open_space")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019", "region_100km_urban", "temperature_annual_average", "shrubs", "region_20km_elevation_delta", "percentage_urban_area_as_open_public_spaces_and_streets", "share_of_population_within_400m_of_open_space", "open_forest")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019", "region_100km_urban", "temperature_annual_average", "shrubs", "region_20km_elevation_delta", "percentage_urban_area_as_open_public_spaces_and_streets", "share_of_population_within_400m_of_open_space", "open_forest", "percentage_urban_area_as_streets")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019", "region_100km_urban", "temperature_annual_average", "shrubs", "region_20km_elevation_delta", "percentage_urban_area_as_open_public_spaces_and_streets", "share_of_population_within_400m_of_open_space", "open_forest", "percentage_urban_area_as_streets", "city_elevation_delta")])
create_fifty_rows_of_oob(birdlife_city_data_fixed[,c("response", "population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water", "temperature_monthly_min", "rainfall_monthly_max", "mean_population_exposure_to_pm2_5_2019", "region_100km_urban", "temperature_annual_average", "shrubs", "region_20km_elevation_delta", "percentage_urban_area_as_open_public_spaces_and_streets", "share_of_population_within_400m_of_open_space", "open_forest", "percentage_urban_area_as_streets", "city_elevation_delta", "realm")])
```

"population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water"

```{r}
either_city_data <- fetch_city_data_for('either')
either_city_data
```

```{r}
either_city_data_fixed <- rfImpute(response ~ ., either_city_data)
either_city_data_fixed
```

```{r}
select_variables_from_random_forest(either_city_data_fixed)
```

```{r}
exclude_either <- !names(either_city_data_fixed) %in% c("region_50km_cultivated", "region_20km_cultivated", "region_50km_average_pop_density", "region_100km_average_pop_density", "region_50km_elevation_delta", "region_100km_elevation_delta", "region_50km_urban", "region_100km_urban", "region_20km_includes_estuary", "region_50km_includes_estuary", "region_100km_includes_estuary", "region_100km_mean_elevation", "region_50km_mean_elevation", "region_20km_mean_elevation")

either_city_data_fixed_single_scale <- either_city_data_fixed[,exclude_either]
either_city_data_fixed_single_scale
```
```{r}
select_variables_from_random_forest(either_city_data_fixed_single_scale)
```


```{r}
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta", "permanent_water")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta", "permanent_water", "mean_population_exposure_to_pm2_5_2019")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta", "permanent_water", "mean_population_exposure_to_pm2_5_2019", "temperature_annual_average")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta", "permanent_water", "mean_population_exposure_to_pm2_5_2019", "temperature_annual_average", "region_20km_urban")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta", "permanent_water", "mean_population_exposure_to_pm2_5_2019", "temperature_annual_average", "region_20km_urban", "percentage_urban_area_as_open_public_spaces_and_streets")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta", "permanent_water", "mean_population_exposure_to_pm2_5_2019", "temperature_annual_average", "region_20km_urban", "percentage_urban_area_as_open_public_spaces_and_streets", "share_of_population_within_400m_of_open_space")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta", "permanent_water", "mean_population_exposure_to_pm2_5_2019", "temperature_annual_average", "region_20km_urban", "percentage_urban_area_as_open_public_spaces_and_streets", "share_of_population_within_400m_of_open_space", "rainfall_monthly_max")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta", "permanent_water", "mean_population_exposure_to_pm2_5_2019", "temperature_annual_average", "region_20km_urban", "percentage_urban_area_as_open_public_spaces_and_streets", "share_of_population_within_400m_of_open_space", "rainfall_monthly_max", "city_elevation_delta")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta", "permanent_water", "mean_population_exposure_to_pm2_5_2019", "temperature_annual_average", "region_20km_urban", "percentage_urban_area_as_open_public_spaces_and_streets", "share_of_population_within_400m_of_open_space", "rainfall_monthly_max", "city_elevation_delta", "herbaceous_wetland")])
create_fifty_rows_of_oob(either_city_data_fixed[,c("response", "either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm", "biome_name", "shrubs", "percentage_urban_area_as_open_public_spaces", "rainfall_monthly_min", "temperature_monthly_min", "region_20km_elevation_delta", "permanent_water", "mean_population_exposure_to_pm2_5_2019", "temperature_annual_average", "region_20km_urban", "percentage_urban_area_as_open_public_spaces_and_streets", "share_of_population_within_400m_of_open_space", "rainfall_monthly_max", "city_elevation_delta", "herbaceous_wetland", "temperature_monthly_max")])
```

"either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm"

```{r}
both_city_data <- fetch_city_data_for('both')
both_city_data
```

```{r}
both_city_data_fixed <- rfImpute(response ~ ., both_city_data)
both_city_data_fixed
```

```{r}
select_variables_from_random_forest(both_city_data_fixed)
```

```{r}
exclude_both <- !names(both_city_data_fixed) %in% c("region_50km_cultivated", "region_20km_cultivated", "region_50km_urban", "region_100km_urban", "region_100km_elevation_delta", "region_20km_elevation_delta", "region_100km_average_pop_density", "region_50km_average_pop_density", "region_20km_includes_estuary", "region_50km_includes_estuary", "region_100km_includes_estuary", "region_100km_mean_elevation", "region_50km_mean_elevation", "region_20km_mean_elevation")

both_city_data_fixed_single_scale <- both_city_data_fixed[,exclude_both]
both_city_data_fixed_single_scale
```

```{r}
select_variables_from_random_forest(both_city_data_fixed_single_scale)
```

```{r}
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect", "population_growth")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect", "population_growth", "region_50km_elevation_delta")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect", "population_growth", "region_50km_elevation_delta", "shrubs")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect", "population_growth", "region_50km_elevation_delta", "shrubs", "city_gdp_per_population")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect", "population_growth", "region_50km_elevation_delta", "shrubs", "city_gdp_per_population", "happiness_future_life")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect", "population_growth", "region_50km_elevation_delta", "shrubs", "city_gdp_per_population", "happiness_future_life", "biome_name")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect", "population_growth", "region_50km_elevation_delta", "shrubs", "city_gdp_per_population", "happiness_future_life", "biome_name", "share_of_population_within_400m_of_open_space")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect", "population_growth", "region_50km_elevation_delta", "shrubs", "city_gdp_per_population", "happiness_future_life", "biome_name", "share_of_population_within_400m_of_open_space", "open_forest")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect", "population_growth", "region_50km_elevation_delta", "shrubs", "city_gdp_per_population", "happiness_future_life", "biome_name", "share_of_population_within_400m_of_open_space", "open_forest", "herbaceous_wetland")])
create_fifty_rows_of_oob(both_city_data_fixed[,c("response", "both_pool_size", "temperature_annual_average", "happiness_negative_effect", "permanent_water", "region_20km_urban", "region_100km_cultivated", "rainfall_monthly_min", "percentage_urban_area_as_open_public_spaces", "realm", "happiness_positive_effect", "population_growth", "region_50km_elevation_delta", "shrubs", "city_gdp_per_population", "happiness_future_life", "biome_name", "share_of_population_within_400m_of_open_space", "open_forest", "herbaceous_wetland", "percentage_urban_area_as_open_public_spaces_and_streets")])
```

"both_pool_size", "temperature_annual_average", "happiness_negative_effect"


------------------------------------------
So....
------------------------------------------
"merlin_pool_size", "realm"
"population_growth", "birdlife_pool_size", "region_100km_cultivated", "biome_name", "rainfall_monthly_min", "region_20km_average_pop_density", "percentage_urban_area_as_open_public_spaces", "permanent_water"
"either_pool_size", "population_growth", "region_100km_cultivated", "region_20km_average_pop_density", "realm"
"both_pool_size", "temperature_annual_average", "happiness_negative_effect"

```{r}
summary(lm(response ~ merlin_pool_size, merlin_city_data_fixed))
summary(lm(response ~ birdlife_pool_size, birdlife_city_data_fixed))
summary(lm(response ~ either_pool_size, either_city_data_fixed))
summary(lm(response ~ both_pool_size, both_city_data_fixed))
```

```{r}
ggplot() + 
  geom_point(aes(x = merlin_pool_size, y = response), merlin_city_data_fixed, color = "red") +
  geom_point(aes(x = birdlife_pool_size, y = response), birdlife_city_data_fixed, color = "blue") +
  geom_point(aes(x = either_pool_size, y = response), either_city_data_fixed, color = "green") +
  geom_point(aes(x = both_pool_size, y = response), both_city_data_fixed, color = "purple")
```
```{r}
summary(lm(response ~ region_100km_cultivated, merlin_city_data_fixed))
summary(lm(response ~ region_100km_cultivated, birdlife_city_data_fixed))
summary(lm(response ~ region_100km_cultivated, either_city_data_fixed))
summary(lm(response ~ region_100km_cultivated, both_city_data_fixed))
```


```{r}
ggplot() + 
  geom_point(aes(x = merlin_pool_size, y = region_100km_cultivated), merlin_city_data_fixed, color = "red") +
  geom_point(aes(x = birdlife_pool_size, y = region_100km_cultivated), birdlife_city_data_fixed, color = "blue") +
  geom_point(aes(x = either_pool_size, y = region_100km_cultivated), either_city_data_fixed, color = "green") +
  geom_point(aes(x = both_pool_size, y = region_100km_cultivated), both_city_data_fixed, color = "purple")
```

```{r}
ggplot() + 
  geom_point(aes(x = population_growth, y = response), merlin_city_data_fixed, color = "red") +
  geom_point(aes(x = population_growth, y = response), birdlife_city_data_fixed, color = "blue") +
  geom_point(aes(x = population_growth, y = response), either_city_data_fixed, color = "green") +
  geom_point(aes(x = population_growth, y = response), both_city_data_fixed, color = "purple")
```
```{r}
ggplot() + 
  geom_point(aes(x = merlin_pool_size, y = region_20km_average_pop_density), merlin_city_data_fixed, color = "red") +
  geom_point(aes(x = birdlife_pool_size, y = region_20km_average_pop_density), birdlife_city_data_fixed, color = "blue") +
  geom_point(aes(x = either_pool_size, y = region_20km_average_pop_density), either_city_data_fixed, color = "green") +
  geom_point(aes(x = both_pool_size, y = region_20km_average_pop_density), both_city_data_fixed, color = "purple")
```

```{r}
summary(lm(response ~ population_growth, merlin_city_data_fixed))
summary(lm(response ~ population_growth, birdlife_city_data_fixed))
summary(lm(response ~ population_growth, either_city_data_fixed))
summary(lm(response ~ population_growth, both_city_data_fixed))
```

```{r}
summary(lm(response ~ rainfall_monthly_min, merlin_city_data_fixed))
summary(lm(response ~ rainfall_monthly_min, birdlife_city_data_fixed))
summary(lm(response ~ rainfall_monthly_min, either_city_data_fixed))
summary(lm(response ~ rainfall_monthly_min, both_city_data_fixed))
```
```{r}
ggplot() + 
  geom_point(aes(x = rainfall_monthly_min, y = response), merlin_city_data_fixed, color = "red") +
  geom_point(aes(x = rainfall_monthly_min, y = response), birdlife_city_data_fixed, color = "blue") +
  geom_point(aes(x = rainfall_monthly_min, y = response), either_city_data_fixed, color = "green") +
  geom_point(aes(x = rainfall_monthly_min, y = response), both_city_data_fixed, color = "purple")
```
```{r}
ggplot() + 
  geom_point(aes(x = temperature_annual_average, y = response), merlin_city_data_fixed, color = "red") +
  geom_point(aes(x = temperature_annual_average, y = response), birdlife_city_data_fixed, color = "blue") +
  geom_point(aes(x = temperature_annual_average, y = response), either_city_data_fixed, color = "green") +
  geom_point(aes(x = temperature_annual_average, y = response), both_city_data_fixed, color = "purple")
```


```{r}
ggplot() + 
  geom_point(aes(x = percentage_urban_area_as_open_public_spaces, y = response), merlin_city_data_fixed, color = "red") +
  geom_point(aes(x = percentage_urban_area_as_open_public_spaces, y = response), birdlife_city_data_fixed, color = "blue") +
  geom_point(aes(x = percentage_urban_area_as_open_public_spaces, y = response), either_city_data_fixed, color = "green") +
  geom_point(aes(x = percentage_urban_area_as_open_public_spaces, y = response), both_city_data_fixed, color = "purple")
```


```{r}
ggplot() + 
  geom_point(aes(x = happiness_negative_effect, y = response), merlin_city_data_fixed, color = "red") +
  geom_point(aes(x = happiness_negative_effect, y = response), birdlife_city_data_fixed, color = "blue") +
  geom_point(aes(x = happiness_negative_effect, y = response), either_city_data_fixed, color = "green") +
  geom_point(aes(x = happiness_negative_effect, y = response), both_city_data_fixed, color = "purple")
```

```{r}
ggplot() + 
  geom_boxplot(aes(x = response, y = biome_name), merlin_city_data_fixed)
```
```{r}
ggplot() + 
  geom_boxplot(aes(x = response, y = biome_name), birdlife_city_data_fixed)
```

```{r}
ggplot() + 
  geom_boxplot(aes(x = response, y = biome_name), either_city_data_fixed)
```

```{r}
ggplot() + 
  geom_boxplot(aes(x = response, y = biome_name), both_city_data_fixed)
```

```{r}
summary(lm(response ~ biome_name, merlin_city_data_fixed))
```


-----------------------------
In Summary
-----------------------------
Response is related to number of species in regional pool, the more species, the less the percentage of species in the city. Indicating a fixed number of species are able to move into cities.
The size of the regional pool is correlated with both the amount of urban and cultivated land cover, both reduce species in the regional pool.

Response is also lower in wet biomes and areas of the world, this is seen through the higher rainfall in the month with least rainfall in the year, and lower percentages in wetter biomes such as flooded grasslands and moist broadleaf forests.

Finally cities with a higher proportion of green public space are less likely to have a low response.


